import numpy as np
import pandas as pd
import pytest

from src.recommend_book_list import recommend_book_list


def test_recommend_book_list(bookname, df):

    df_in_values1 = [[0.0, 0.2741935483870968, 0.41935483870967805, 0.6451612903225808,
                      1.0, 0.3548387096774199, 0.016129032258064183,
                      0.5000000000000003, 0.32258064516129076, 0.7903225806451614,
                      0.3870967741935482, 0.5322580645161287, 0.06451612903225816,
                      0.5322580645161287, 0.6290322580645167, 0.338709677419355,
                      0.37096774193548404, 0.6129032258064525, 0.6129032258064525,
                      0.17741935483870958],
                     [0.05454545454545416, 0.12727272727272693, 0.8727272727272722,
                      1.0, 0.9272727272727272, 0.1636363636363633, 0.0,
                      0.43636363636363573, 0.12727272727272693, 0.47272727272727294,
                      0.45454545454545353, 0.8181818181818173, 0.018181818181817785,
                      0.43636363636363573, 0.3272727272727274, 0.8727272727272722,
                      0.4000000000000002, 0.8727272727272722, 0.654545454545454,
                      0.6727272727272718],
                     [0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                      0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 1.0],
                     [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0,
                      0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                     [0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                      0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                     [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                      0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                     [0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 1.0,
                      0.0, 0.0, 1.0, 1.0, 1.0, 0.0, 0.0],
                     [1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                      0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                     [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 1.0, 0.0, 0.0, 0.0,
                      0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                     [0.007467190264384841, 0.020408016752494634, 0.021608725870839417,
                      0.00026831990013833284, 0.028981690083336214,
                      0.008719948059010635, 5.1151285310652076e-05,
                      0.017774174254481235, 0.0028083850417488713, 0.9125308534232998,
                      0.002144764419165938, 0.0003585076926597457, 0.0,
                      0.007435332884936978, 0.0050271842159697, 0.00040113376375195575,
                      0.000749770155737716, 0.0008098953507519912, 1.0,
                      0.0006120206417871003],
                     [0.0052667897952142235, 0.042885267195713506, 0.03048446347750198,
                      0.0004363621602971322, 0.051947392989791154, 0.01199488542956303,
                      0.0, 0.023675184185423474, 0.007945850500294291, 1.0,
                      0.0033792697529987214, 0.001349678309756246,
                      0.0006596172190538044, 0.01875342493556047, 0.010807574435266181,
                      0.0012583466948103347, 0.003541637068458119,
                      0.0025674331757017314, 0.6614945911388037, 0.0013293823953238213]]

    df_in_index1 = ['author_average_rating', 'book_average_rating', 'genre_1_Fiction',
                    'genre_1_Mystery', 'genre_1_Nonfiction', 'genre_1_Paranormal',
                    'genre_1_Romance', 'genre_1_Sequential Art', 'genre_1_Young Adult',
                    'num_ratings', 'num_reviews'],
    df_in_columns1 = ['30 Days of Night, Vol. 1',
                      'Bonk: The Curious Coupling of Science and Sex', 'Devil in Winter',
                      'Dirty Ross', 'Firefight', 'Island', 'Kiss of the Vampire',
                      'Leaving Paradise', 'Loki\'s Wolves', 'Mockingjay',
                      'Murder on St. Mark\'s Place', 'Pull Me Under', 'Screwups',
                      'Sorcery & Cecelia: or The Enchanted Chocolate Pot', 'Stalk Me',
                      'Strength of the Mate', 'Tailored for Trouble', 'Tequila Mockingbird',
                      'The Girl with the Dragon Tattoo', 'The Obscene Bird of Night']

    df_in1 = pd.DataFrame(df_in_values1, index=df_in_index1, columns=df_in_columns1)

    df_true1 = pd.DataFrame([[0.9999999999999998],
                             [0.8717768829124013],
                             [0.602886324568788],
                             [0.23055131463439302],
                             [0.20222377908223135],
                             [0.19116301254710374],
                             [0.017298726819574676],
                             [0.009920630640171266],
                             [0.000942011078821117],
                             [-0.005453658577388588]],
                            index=['Island', 'The Obscene Bird of Night',
                                   'The Girl with the Dragon Tattoo', 'Loki\'s Wolves',
                                   'Sorcery & Cecelia: or The Enchanted Chocolate Pot', 'Firefight',
                                   'Dirty Ross', 'Tequila Mockingbird', 'Stalk Me', 'Pull Me Under'],
                            columns=['Correlation'])

    df_true1.index.name = 'book_title'

    df_test1 = recommend_book_list('Island', df_in1)

    assert df_test1.equals(df_true1)


def test_recommend_book_list_non_df():
    df_in = "I am not a dataframe"
    with pytest.raises(TypeError):
        recommend_book_list('Island', df_in)

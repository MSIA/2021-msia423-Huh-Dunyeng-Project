import numpy as np
import pandas as pd
import pytest

from src.EDA import clean_data


def test_clean_data(df):
    """ check if clean_data() function works
    arg: dataframe
    """
    df_in_values = [[4.01, 'female', 'historical-fiction,', 74489,
                     'Victoria Thompson\n', '/author/show/74489.Victoria_Thompson',
                     74399, 6268, ' United States\n    ', 4.02,
                     'https://www.goodreads.com/book/show/686717.Murder_on_St_Mark_s_Place',
                     '686717', "Murder on St. Mark's Place", 'Mystery', 'Historical',
                     5260, 375, '277', '2000', 3230],
                    [4.15, 'male', 'literature-fiction,mystery-thrillers,', 706255,
                     'Stieg Larsson\n', '/author/show/706255.Stieg_Larsson', 3726435,
                     142704, 'Sweden\n    ', 4.13,
                     'https://www.goodreads.com/book/show/2429135.The_Girl_with_the_Dragon_Tattoo',
                     '2429135', 'The Girl with the Dragon Tattoo', 'Fiction',
                     'Mystery', 2229163, 65227, '465', 'August 2005', 3062],
                    [4.0, 'female', 'romance,', 5618190, 'Mimi Jean Pamfiloff\n',
                     '/author/show/5618190.Mimi_Jean_Pamfiloff', 76496, 7975,
                     ' United States\n  ', 3.99,
                     'https://www.goodreads.com/book/show/27833684-tailored-for-trouble',
                     '27833684', 'Tailored for Trouble', 'Romance', 'Contemporary',
                     2151, 391, '354', '2016', 4585],
                    [3.88, 'male', 'fiction,memoir,', 37871, 'Jos√© Donoso\n',
                     '/author/show/37871.Jos_Donoso', 5522, 489, 'Chile\n    ', 4.14,
                     'https://www.goodreads.com/book/show/382975.The_Obscene_Bird_of_Night',
                     '382975', 'The Obscene Bird of Night', 'Fiction',
                     'Magical Realism', 1844, 173, '438', '1970', 1533],
                    [4.1, 'female', 'young-adult,fantasy,', 36122,
                     'Patricia C. Wrede\n', '/author/show/36122.Patricia_C_Wrede',
                     291013, 13453, ' United States\n    ', 4.01,
                     'https://www.goodreads.com/book/show/64207.Sorcery_Cecelia',
                     '64207', 'Sorcery & Cecelia: or The Enchanted Chocolate Pot',
                     'Fantasy', 'Young Adult', 17051, 1890, '326', 'April 15th 1988',
                     2105],
                    [3.77, 'male', 'horror,', 58947, 'Steve Niles\n',
                     '/author/show/58947.Steve_Niles', 47938, 3240,
                     ' United States\n    ', 3.8,
                     'https://www.goodreads.com/book/show/831829.30_Days_of_Night_Vol_1',
                     '831829', '30 Days of Night, Vol. 1', 'Sequential Art',
                     'Sequential Art', 17122, 561, '104', 'January 10th 2004', 4372],
                    [4.16, 'female', 'romance,', 4833990, 'Jillian Dodd\n',
                     '/author/show/4833990.Jillian_Dodd', 110522, 9451, '\n  ', 3.95,
                     'https://www.goodreads.com/book/show/34804503-stalk-me',
                     '34804503', 'Stalk Me', 'Young Adult', 'Romance', 11684, 1107,
                     '327', 'August 20th 2012', 2396],
                    [3.94, 'female', 'nonfiction,', 7956, 'Mary Roach\n',
                     '/author/show/7956.Mary_Roach', 321197, 29747,
                     ' United States\n  ', 3.84,
                     'https://www.goodreads.com/book/show/5981308-bonk', '5981308',
                     'Bonk: The Curious Coupling of Science and Sex', 'Nonfiction',
                     'Science', 45963, 4268, '319', '2008', 2054],
                    [3.78, 'female', 'fantasy,', 155651, 'Nancy Baker\n',
                     '/author/show/155651.Nancy_Baker', 1019, 104, '\n  Canada\n  ',
                     3.77,
                     'https://www.goodreads.com/book/show/266600.Kiss_of_the_Vampire',
                     '266600', 'Kiss of the Vampire', 'Paranormal', 'Horror', 594, 42,
                     '278', 'January 1st 1993', 1311],
                    [4.08, 'female', 'young-adult,', 274533, 'Simone Elkeles\n',
                     '/author/show/274533.Simone_Elkeles', 481114, 25166,
                     ' United States\n  ', 4.01,
                     'https://www.goodreads.com/book/show/544424.Leaving_Paradise',
                     '544424', 'Leaving Paradise', 'Young Adult', 'Romance', 40093,
                     2375, '303', 'April 1st 2007', 1994],
                    [4.39, 'male', 'science-fiction-fantasy,', 38550,
                     'Brandon Sanderson\n', '/author/show/38550.Brandon_Sanderson',
                     2613993, 170695, ' United States\n  ', 4.28,
                     'https://www.goodreads.com/book/show/15704459-firefight',
                     '15704459', 'Firefight', 'Fantasy', 'Young Adult', 65071, 5161,
                     '416', '2015', 4347],
                    [3.97, 'male', 'children-s,', 4773763, 'K.L. Armstrong\n',
                     '/author/show/4773763.K_L_Armstrong', 11972, 1256,
                     '\n  Canada\n  ', 3.84,
                     'https://www.goodreads.com/book/show/11438693-loki-s-wolves',
                     '11438693', "Loki's Wolves", 'Fantasy', 'Fantasy', 6739, 825,
                     '358', '2013', 7818],
                    [4.03, 'female', 'romance,literature-fiction,', 27847,
                     'Lisa Kleypas\n', '/author/show/27847.Lisa_Kleypas', 800760,
                     50323, ' United States\n  ', 4.25,
                     'https://www.goodreads.com/book/show/114166.Devil_in_Winter',
                     '114166', 'Devil in Winter', 'Romance', 'Romance', 48639, 3046,
                     '368', '2006', 7874],
                    [4.26, 'female', 'fiction,science-fiction-fantasy,', 153394,
                     'Suzanne Collins\n', '/author/show/153394.Suzanne_Collins',
                     10212155, 370569, ' United States\n    ', 4.03,
                     'https://www.goodreads.com/book/show/7260188-mockingjay',
                     '7260188', 'Mockingjay', 'Young Adult', 'Science Fiction',
                     2034222, 98584, '392', '2010', 12662],
                    [3.99, 'male', 'literature-fiction,poetry,', 3487,
                     'Aldous Huxley\n', '/author/show/3487.Aldous_Huxley', 1473109,
                     31915, ' United Kingdom\n    ', 3.86,
                     'https://www.goodreads.com/book/show/5130.Island', '5130',
                     'Island', 'Fiction', 'Classics', 19914, 1224, '354', '1962',
                     8460],
                    [4.17, 'male', 'gay-male-romances,', 5619151,
                     'Sandrine Gasq-Dion\n',
                     '/author/show/5619151.Sandrine_Gasq_Dion', 59146, 4713,
                     ' United States\n    ', 4.32,
                     'https://www.goodreads.com/book/show/21922133-dirty-ross',
                     '21922133', 'Dirty Ross', 'Romance', 'Fantasy', 1078, 85, '284',
                     'April 7th 2014', 2246],
                    [3.81, 'male', 'gay-lesbian,', 4476044, 'Jamie Fessenden\n',
                     '/author/show/4476044.Jamie_Fessenden', 8147, 1761,
                     '\n   United States\n  ', 3.78,
                     'https://www.goodreads.com/book/show/20744130-screwups',
                     '20744130', 'Screwups', 'Romance', 'Academic', 480, 107, '204',
                     'March 6th 2014', 2323],
                    [4.1, 'female', 'gay-and-lesbian,', 7851984, 'Zarah Detand\n',
                     '/author/show/7851984.Zarah_Detand', 1926, 264, '\n  ', 4.22,
                     'https://www.goodreads.com/book/show/20816370-pull-me-under',
                     '20816370', 'Pull Me Under', 'Romance', 'Sports and Games', 1279,
                     175, '359', '2014', 2373],
                    [3.98, 'female', 'romance,', 5771850, 'Kendall McKenna\n',
                     '/author/show/5771850.Kendall_McKenna', 9655, 1474,
                     ' United States\n  ', 4.25,
                     'https://www.goodreads.com/book/show/18221995-strength-of-the-mate',
                     '18221995', 'Strength of the Mate', 'Romance', 'War', 1374, 166,
                     '356', '2014', 2374],
                    [4.15, 'female', 'gay-lesbian,', 4968409, 'Rhys Ford\n',
                     '/author/show/4968409.Rhys_Ford', 47018, 7768,
                     ' United States\n  ', 4.25,
                     'https://www.goodreads.com/book/show/40983132-tequila-mockingbird',
                     '40983132', 'Tequila Mockingbird', 'Romance', 'Contemporary',
                     2285, 295, '250', 'June 26th 2014', 2383]]

    df_in_index = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19]

    df_in_columns = ['author_average_rating', 'author_gender', 'author_genres', 'author_id',
                     'author_name', 'author_page_url', 'author_rating_count',
                     'author_review_count', 'birthplace', 'book_average_rating',
                     'book_fullurl', 'book_id', 'book_title', 'genre_1', 'genre_2',
                     'num_ratings', 'num_reviews', 'pages', 'publish_date', 'score']

    df_in = pd.DataFrame(df_in_values, index=df_in_index, columns=df_in_columns)

    df_true = pd.DataFrame(
        [[0.0, 0.2741935483870968, 0.41935483870967805, 0.6451612903225808,
          1.0, 0.3548387096774199, 0.016129032258064183,
          0.5000000000000003, 0.32258064516129076, 0.7903225806451614,
          0.3870967741935482, 0.5322580645161287, 0.06451612903225816,
          0.5322580645161287, 0.6290322580645167, 0.338709677419355,
          0.37096774193548404, 0.6129032258064525, 0.6129032258064525,
          0.17741935483870958],
         [0.05454545454545416, 0.12727272727272693, 0.8727272727272722,
          1.0, 0.9272727272727272, 0.1636363636363633, 0.0,
          0.43636363636363573, 0.12727272727272693, 0.47272727272727294,
          0.45454545454545353, 0.8181818181818173, 0.018181818181817785,
          0.43636363636363573, 0.3272727272727274, 0.8727272727272722,
          0.4000000000000002, 0.8727272727272722, 0.654545454545454,
          0.6727272727272718],
         [0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
          0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 1.0],
         [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0,
          0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
         [0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
          0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
         [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
          0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
         [0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 1.0,
          0.0, 0.0, 1.0, 1.0, 1.0, 0.0, 0.0],
         [1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
          0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
         [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 1.0, 0.0, 0.0, 0.0,
          0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0],
         [0.007467190264384841, 0.020408016752494634, 0.021608725870839417,
          0.00026831990013833284, 0.028981690083336214,
          0.008719948059010635, 5.1151285310652076e-05,
          0.017774174254481235, 0.0028083850417488713, 0.9125308534232998,
          0.002144764419165938, 0.0003585076926597457, 0.0,
          0.007435332884936978, 0.0050271842159697, 0.00040113376375195575,
          0.000749770155737716, 0.0008098953507519912, 1.0,
          0.0006120206417871003],
         [0.0052667897952142235, 0.042885267195713506, 0.03048446347750198,
          0.0004363621602971322, 0.051947392989791154, 0.01199488542956303,
          0.0, 0.023675184185423474, 0.007945850500294291, 1.0,
          0.0033792697529987214, 0.001349678309756246,
          0.0006596172190538044, 0.01875342493556047, 0.010807574435266181,
          0.0012583466948103347, 0.003541637068458119,
          0.0025674331757017314, 0.6614945911388037, 0.0013293823953238213]],
        index=['author_average_rating', 'book_average_rating', 'genre_1_Fiction',
               'genre_1_Mystery', 'genre_1_Nonfiction', 'genre_1_Paranormal',
               'genre_1_Romance', 'genre_1_Sequential Art', 'genre_1_Young Adult',
               'num_ratings', 'num_reviews'],
        columns=['30 Days of Night, Vol. 1',
                 'Bonk: The Curious Coupling of Science and Sex', 'Devil in Winter',
                 'Dirty Ross', 'Firefight', 'Island', 'Kiss of the Vampire',
                 'Leaving Paradise', 'Loki\'s Wolves', 'Mockingjay',
                 'Murder on St. Mark\'s Place', 'Pull Me Under', 'Screwups',
                 'Sorcery & Cecelia: or The Enchanted Chocolate Pot', 'Stalk Me',
                 'Strength of the Mate', 'Tailored for Trouble', 'Tequila Mockingbird',
                 'The Girl with the Dragon Tattoo', 'The Obscene Bird of Night'])

    df_true.columns.name = 'book_title'

    df_test = clean_data(df_in)

    assert df_test.equals(df_true)


def test_clean_data_non_df():
    df_in = "I am not a dataframe"
    with pytest.raises(TypeError):
        clean_data(df_in)